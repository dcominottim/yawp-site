





<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="A simple yet comprehensive tutorial that shows how to use the fundamental features of the YAWP! framework in practice.">
    
    <meta name="author" content="Fernando Ultremare and YAWP! contributors">
    <meta name="google-site-verification" content="M6k8Ek0uNY4lajqXCtfLutObDtu7H9jDeEU7W35F9nY" />

    <title>YAWP! - Tutorials: To-do list app</title>

    <!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/assets/css/freelancer.css" rel="stylesheet">
    <link href="/assets/css/yawp.css" rel="stylesheet">
    <link href="/assets/css/github-ribbon.css" rel="stylesheet">
    <link href="/assets/css/guides.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="httpS://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="httpS://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- code formating -->
    <script src="https://cdn.jsdelivr.net/highlight.js/8.9.1/highlight.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-54832827-1', 'auto');
    ga('send', 'pageview');

    </script>
    <!-- End Google Analytics -->

    <!-- Begin Inspectlet Embed Code -->
    <script type="text/javascript" id="inspectletjs">
    window.__insp = window.__insp || [];
    __insp.push(['wid', 86703955]);
    (function() {
    function ldinsp(){if(typeof window.__inspld != "undefined") return; window.__inspld = 1; var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
    setTimeout(ldinsp, 500); document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
    })();
    </script>
    <!-- End Inspectlet Embed Code -->


    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/8.9.1/styles/atelier-cave.light.min.css">
    

    

</head>

<body id="page-top" class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                
                    <a class="navbar-brand" href="/">YAWP!</a>
                
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="main-navbar collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <!-- <li class="page-scroll">
                        <a href="#page-top">Home</a>
                    </li> -->
                    <li class="">
                        <a href="/#portfolio">Features</a>
                    </li>
                    <li class="">
                        <a href="/#kickstart">Kickstart</a>
                    </li>
                    <li class="">
                        <a href="/#community">Community</a>
                    </li>
                    <li class="active">
                        <a href="/guides">Guides</a>
                    </li>
                    <li class="">
                        <a href="/blog">Blog</a>
                    </li>
                    <li>
                        <a href="http://github.com/feroult/yawp" target="_blank">GITHUB&nbsp;&nbsp;<i class="fa fa-github" style="font-size: 1.2em;"></i></a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    





<div class="container">
    <div id="accordion" class="panel-group">
        <div class="sidebar">
            <div class="panel panel-default">
                <a data-toggle="collapse" href="#getting-started">
                    <div class="panel-heading">
                        <h4 class="panel-title">Getting Started</h4>
                    </div>
                </a>

                <div id="getting-started" class="panel-collapse collapse ">
                    <div class="panel-body">
                        <ul>
                            <a href="/guides/getting-started/introduction">
                                <li class="introduction">
                                    Introduction
                                </li>
                            </a>                           
                            <a href="/guides/getting-started/installing-yawp">
                                <li class="installing-yawp">
                                    Installing YAWP!
                                </li>
                            </a>
                            <a href="/guides/getting-started/google-appengine-deploy">
                                <li class="google-appengine-deploy">
                                    Google Appengine Deploy
                                </li>
                            </a>
                            <a href="/guides/getting-started/your-first-api">
                                <li class="your-first-api">
                                    Your first API
                                </li>
                            </a>
                            <a href="/guides/getting-started/core-concepts">
                                <li class="core-concepts">
                                    Core concepts
                                </li>
                            </a>
                            <a href="/guides/getting-started/supported-platforms">
                                <li class="supported-platforms">
                                    Supported platforms
                                </li>
                            </a>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <a data-toggle="collapse" href="#tutorials">
                    <div class="panel-heading">
                        <h4 class="panel-title">Tutorials</h4>
                    </div>
                </a>

                <div id="tutorials" class="panel-collapse collapse in">
                    <div class="panel-body">
                        <ul>
                            <a href="/guides/tutorials/todo-list-app">
                                <li class="todo-list-app">
                                    To-do list app
                                </li>
                            </a>
                            <a href="/guides/tutorials/scaffolding">
                                <li class="scaffolding">
                                    Scaffolding
                                </li>
                            </a>
                            <a href="/guides/tutorials/the-javascript-client">
                                <li class="the-javascript-client">
                                    The Javascript client
                                </li>
                            </a>
                            <a href="/guides/tutorials/the-java-client">
                                <li class="the-java-client">
                                    The Java client
                                </li>
                            </a>
                            
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <a data-toggle="collapse" href="#api">
                    <div class="panel-heading">
                        <h4 class="panel-title">API</h4>
                    </div>
                </a>

                <div id="api" class="panel-collapse collapse ">
                    <div class="panel-body">
                        <ul>
                            <a href="/guides/api/models">
                                <li class="models">
                                    Models
                                </li>
                            </a>
                            <a href="/guides/api/repository-actions">
                                <li class="repository-actions">
                                    Repository Actions
                                </li>
                            </a>
                            <a href="/guides/api/actions">
                                <li class="actions">
                                    Actions
                                </li>
                            </a>
                            <a href="/guides/api/query">
                                <li class="query">
                                    Query
                                </li>
                            </a>
                            <a href="/guides/api/transformers">
                                <li class="transformers">
                                    Transformers
                                </li>
                            </a>
                            <a href="/guides/api/shields">
                                <li class="shields">
                                    Shields
                                </li>
                            </a>
                            <a href="/guides/api/hooks">
                                <li class="hooks">
                                    Hooks
                                </li>
                            </a>
                            <a href="/guides/api/pipes">
                                <li class="pipes">
                                    Pipes
                                </li>
                            </a>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="guide">
        <h1 id="to-do-list-app">To-do list app</h1>

<p>This is a simple yet comprehensive tutorial that shows how to use the fundamental features
of the <strong>YAWP!</strong> framework in practice.</p>

<h3 id="contents">Contents</h3>

<ul>
  <li><a href="#the-app-backlog">The App Backlog</a></li>
  <li><a href="#source-code">Source Code</a></li>
  <li><a href="#create-the-app-project">Create the App Project</a></li>
  <li><a href="#user-story-create-tasks">#1 User Story: Create Tasks</a></li>
  <li><a href="#user-story-add-notes">#2 User Story: Add Notes</a></li>
  <li><a href="#user-story-mark-as-done">#3 User Story: Mark as Done</a></li>
  <li><a href="#user-story-privacy">#4 User Story: Privacy</a></li>
</ul>

<h3 id="the-app-backlog">The App Backlog</h3>

<p>Before we start to code our to-do list API, let’s take a look at the wish list of our “customer”:</p>

<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Story</th>
      <th>As a user I want…</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Create Tasks</td>
      <td>To create tasks so I can remember to do things</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Add Notes</td>
      <td>To add notes to a task before it is complete</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Mark as Done</td>
      <td>To mark my tasks as done so I can see only unfinished tasks</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Privacy</td>
      <td>That my tasks are only visible to me</td>
    </tr>
  </tbody>
</table>

<h3 id="source-code">Source Code</h3>

<p>For reference, the complete source code of this tutorial can be found <a href="https://github.com/feroult/yawp-tutorials/tree/master/todoapp">here</a>.</p>

<h3 id="create-the-app-project">Create the App Project</h3>

<p>To bootstrap our API, let’s use the <strong>YAWP!</strong> maven archetype:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mvn archetype:generate <span class="se">\</span>
   -DarchetypeGroupId<span class="o">=</span>io.yawp -DarchetypeArtifactId<span class="o">=</span>yawp -DarchetypeVersion<span class="o">=</span>LATEST <span class="se">\</span>
   -DgroupId<span class="o">=</span>todoapp -DartifactId<span class="o">=</span>todoapp -Dversion<span class="o">=</span>1.0-SNAPSHOT
</code></pre>
</div>

<p>Inside the app folder, start the development server:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">cd </span>todoapp
mvn yawp:devserver
</code></pre>
</div>

<p><strong>Note:</strong> If you are using an IDE that automatically compiles to the project’s
target folder, you won’t need to restart the development server again, your changes will get
<strong>hot deployed</strong> by the yawp’s maven plugin.</p>

<h3 id="1-user-story-create-tasks">#1 User Story: Create Tasks</h3>

<p>To get the first user story done we’re going to need a place to store our tasks information.
To do this, we will create a <strong>Task</strong> endpoint running the yawp’s scaffolding plugin.</p>

<p>Open another shell window/tab and run the following command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mvn yawp:endpoint -Dmodel<span class="o">=</span>task
</code></pre>
</div>

<p>The scaffold will create three files:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">[</span><span class="n">INFO</span><span class="o">]</span> <span class="n">Scaffold</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">todoapp</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">task</span><span class="o">/</span><span class="n">Task</span><span class="o">.</span><span class="na">java</span> <span class="n">created</span><span class="o">.</span>
<span class="o">[</span><span class="n">INFO</span><span class="o">]</span> <span class="n">Scaffold</span> <span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">todoapp</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">task</span><span class="o">/</span><span class="n">TaskTest</span><span class="o">.</span><span class="na">java</span> <span class="n">created</span><span class="o">.</span>
<span class="o">[</span><span class="n">INFO</span><span class="o">]</span> <span class="n">Scaffold</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">todoapp</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">task</span><span class="o">/</span><span class="n">TaskShield</span><span class="o">.</span><span class="na">java</span> <span class="n">created</span><span class="o">.</span>
</code></pre>
</div>

<p>Let’s take a look at the <strong>TaskTest</strong> class:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskTest</span> <span class="kd">extends</span> <span class="n">EndpointTestCase</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">post</span><span class="o">(</span><span class="s">"/tasks"</span><span class="o">,</span> <span class="s">"{}"</span><span class="o">);</span>
        <span class="n">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="n">from</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">assertNotNull</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>Now, let’s make the test more realistic by adding some information to the task model:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskTest</span> <span class="kd">extends</span> <span class="n">EndpointTestCase</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">post</span><span class="o">(</span><span class="s">"/tasks"</span><span class="o">,</span> <span class="s">"{ 'title': 'wash dishes' }"</span><span class="o">);</span>
        <span class="n">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="n">from</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"wash dishes"</span><span class="o">,</span> <span class="n">task</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>Just remember to import as static the <strong>assertEquals</strong> method.</p>

<p>Now, our test class is not compiling because the title field does not exist in the <strong>Task</strong> endpoint class.
Open it to add the title attribute:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Endpoint</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/tasks"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="n">IdRef</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">id</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">title</span><span class="o">;</span>

<span class="o">}</span>
</code></pre>
</div>

<p>All endpoints must have one and only one <strong>@Id</strong> attribute. It also has to be of type <strong>IdRef&lt;T&gt;</strong>,
where T is the endpoint POJO class.</p>

<p>If we run the unit test again, everything should be ok. With this, we already have an API to create
tasks. We can verify it with cURL:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>curl -H <span class="s2">"Content-type: application/json"</span> -X POST <span class="se">\</span>
     -d <span class="s2">"{'title': 'test task'}"</span> http://localhost:8080/api/tasks
</code></pre>
</div>

<p>You should also try the yawp’s <a href="/guides/tutorials/the-javascript-client">javascript client</a>. Since the library
is already loaded in this tutorial page, you can open the javascript console of your browser and type:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// create a task</span>
<span class="nx">yawp</span><span class="p">(</span><span class="s1">'/tasks'</span><span class="p">).</span><span class="nx">create</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'js task'</span> <span class="p">});</span>

<span class="c1">// list the tasks</span>
<span class="nx">yawp</span><span class="p">(</span><span class="s1">'/tasks'</span><span class="p">).</span><span class="nx">list</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tasks</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span> <span class="p">});</span>
</code></pre>
</div>

<h3 id="2-user-story-add-notes">#2 User Story: Add Notes</h3>

<p>Picking the next item in our backlog, we are going to make it possible to add text notes to each task.</p>

<p>Lets increment our unit test to deal with this new requirement:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCreateWithNotes</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">post</span><span class="o">(</span><span class="s">"/tasks"</span><span class="o">,</span> <span class="s">"{ notes: ['note 1', 'note 2'] }"</span><span class="o">);</span>
    <span class="n">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="n">from</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">task</span><span class="o">.</span><span class="na">notes</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"note 1"</span><span class="o">,</span> <span class="n">task</span><span class="o">.</span><span class="na">notes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"note 2"</span><span class="o">,</span> <span class="n">task</span><span class="o">.</span><span class="na">notes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Open the <strong>Task</strong> class and add the following attribute:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Json</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">notes</span><span class="o">;</span>
</code></pre>
</div>

<p>If we run our tests, they should pass.</p>

<p>You may have noticed that you’ll only need to add getters and setters to the endpoint attributes
if you’re going to access them from your server side (java) code outside the endpoint’s package.
Also, notice that the <strong>@Json</strong> annotation is used to tell the framework that the attribute
will be serialized as a json object when the model is read from or written to the persistence layer.</p>

<p>We can test our new API with javascript:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// to create a task with notes</span>
<span class="nx">yawp</span><span class="p">(</span><span class="s1">'/tasks'</span><span class="p">).</span><span class="nx">create</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'task1'</span><span class="p">,</span>
                        <span class="na">notes</span><span class="p">:</span> <span class="p">[</span><span class="s1">'note 1'</span><span class="p">,</span> <span class="s1">'note 2'</span><span class="p">]</span> <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">task</span><span class="p">))</span> <span class="p">{</span>

    <span class="c1">// to change the notes of an already created task</span>
    <span class="nx">yawp</span><span class="p">(</span><span class="nx">task</span><span class="p">).</span><span class="nx">patch</span><span class="p">({</span> <span class="na">notes</span><span class="p">:</span> <span class="p">[</span><span class="s1">'note 3'</span><span class="p">]</span> <span class="p">});</span>

<span class="p">});</span>
</code></pre>
</div>

<h3 id="3-user-story-mark-as-done">#3 User Story: Mark as Done</h3>

<p>To mark a task as done, we’re going to create a custom action. Let’s first add a test:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMarkAsDone</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">post</span><span class="o">(</span><span class="s">"/tasks/1"</span><span class="o">,</span> <span class="s">"{}"</span><span class="o">);</span>
    <span class="n">assertFalse</span><span class="o">(</span><span class="n">yawp</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">fetch</span><span class="o">(</span><span class="mi">1</span><span class="n">l</span><span class="o">).</span><span class="na">isDone</span><span class="o">());</span>

    <span class="n">put</span><span class="o">(</span><span class="s">"/tasks/1/done"</span><span class="o">);</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">yawp</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">fetch</span><span class="o">(</span><span class="mi">1</span><span class="n">l</span><span class="o">).</span><span class="na">isDone</span><span class="o">());</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Create the missing task method and then run the test above. As you can see, we get an error
saying that there is no endpoint called done. This is because <strong>YAWP!</strong> cannot find a route
for that uri.</p>

<p>Let’s create an action for the given route using a scaffold:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mvn yawp:action -Dmodel<span class="o">=</span>task -Dname<span class="o">=</span>MarkAsDone
</code></pre>
</div>

<p>Open the created class <strong>TaskMarkAsDoneAction</strong> and make the following changes:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskMarkAsDoneAction</span> <span class="kd">extends</span> <span class="n">Action</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@PUT</span><span class="o">(</span><span class="s">"done"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">IdRef</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="n">id</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
        <span class="n">task</span><span class="o">.</span><span class="na">markAsDone</span><span class="o">();</span>
        <span class="n">yawp</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>Finally, change the <strong>Task</strong> endpoint to add the done flag:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kt">boolean</span> <span class="n">done</span><span class="o">;</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">markAsDone</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">done</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDone</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">done</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Run the tests again, they should pass. Again, to access the API with javascript:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">yawp</span><span class="p">(</span><span class="s1">'/tasks'</span><span class="p">).</span><span class="nx">create</span><span class="p">({}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">yawp</span><span class="p">(</span><span class="nx">task</span><span class="p">).</span><span class="nx">put</span><span class="p">(</span><span class="s1">'done'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<h3 id="4-user-story-privacy">#4 User Story: Privacy</h3>

<p>The last item in our MVP backlog tells that the user doesn’t want that other users have access to its
tasks information. First let’s add a test for that:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPrivacy</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">helper</span><span class="o">().</span><span class="na">login</span><span class="o">(</span><span class="s">"janes"</span><span class="o">,</span> <span class="s">"rock.com"</span><span class="o">);</span>
    <span class="n">post</span><span class="o">(</span><span class="s">"/tasks"</span><span class="o">,</span> <span class="s">"{ title: 'janes task' }"</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">tasks1</span> <span class="o">=</span> <span class="n">fromList</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/tasks"</span><span class="o">),</span> <span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">tasks1</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"janes task"</span><span class="o">,</span> <span class="n">tasks1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">title</span><span class="o">);</span>

    <span class="n">helper</span><span class="o">().</span><span class="na">login</span><span class="o">(</span><span class="s">"jim"</span><span class="o">,</span> <span class="s">"rock.com"</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">tasks2</span> <span class="o">=</span> <span class="n">fromList</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/tasks"</span><span class="o">),</span> <span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">tasks2</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="n">AppengineTestHelper</span> <span class="nf">helper</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">AppengineTestHelper</span><span class="o">)</span> <span class="n">helper</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Note that we are using the specific <strong>AppengineTestHelper</strong> because this environment already has a default
support for users authentication. If we run it, the test should fail because the user Jim has access
to the Janes’ task.</p>

<p>Now, to fulfill this requirement we need to assign tasks to users. Let’s change our <strong>Task</strong> class to add
this association:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Index</span>
<span class="n">String</span> <span class="n">user</span><span class="o">;</span>
</code></pre>
</div>

<p>Plus, to assign tasks to users we also need to add an endpoint Hook that sets the user attribute before the
security shield kicks in. Again, using a scaffold:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mvn yawp:hook -Dmodel<span class="o">=</span>task -Dname<span class="o">=</span>SetUser
</code></pre>
</div>

<p>Change the generated scaffold file to look like the following snippet:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskSetUserHook</span> <span class="kd">extends</span> <span class="n">Hook</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeShield</span><span class="o">(</span><span class="n">Task</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">userService</span><span class="o">().</span><span class="na">isUserLoggedIn</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">task</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">().</span><span class="na">getCurrentUser</span><span class="o">().</span><span class="na">getEmail</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">UserService</span> <span class="nf">userService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">UserServiceFactory</span><span class="o">.</span><span class="na">getUserService</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>The privacy test should still be failing. Now it is time to add logic to our security shield that
will handle the privacy requirement. Open the class <strong>TaskShield</strong> and change its contents to the
following:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskShield</span> <span class="kd">extends</span> <span class="n">Shield</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">defaults</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">allow</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="s">"="</span><span class="o">,</span> <span class="n">currentUserEmail</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">currentUserEmail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">UserServiceFactory</span><span class="o">.</span><span class="na">getUserService</span><span class="o">().</span><span class="na">getCurrentUser</span><span class="o">().</span><span class="na">getEmail</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Run the <strong>TaskTest</strong> suite again. Oooops, now only the <strong>testPrivacy</strong> method is passing. This is
because the other tests do not login the user before they create tasks. Lets fix this by adding a
default user to all tests. Just add the following snippet before section to the <strong>TaskTest</strong> class:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Before</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">defaultLogin</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">helper</span><span class="o">().</span><span class="na">login</span><span class="o">(</span><span class="s">"default"</span><span class="o">,</span> <span class="s">"rock.com"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Run the tests again, they should pass.</p>

    </div>
</div>


    <!-- Footer -->
    <footer class="text-center">
        <div class="footer-above">
            <div class="container">
                <div class="row">
                    <div class="footer-col col-md-4 col-md-offset-4">
                        <ul class="list-inline">
                            <li>
                                <a href="http://github.com/feroult/yawp" target="_blank" class="btn-social btn-outline"><i class="fa fa-fw fa-github"></i></a>
                            </li>
                            <li>
                                <a href="https://twitter.com/yawpio" target="_blank" class="btn-social btn-outline"><i class="fa fa-fw fa-twitter"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <strong>YAWP!</strong> is released under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT license</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/assets/js/jquery.js"></script>
    <script src="https://rawgit.com/feroult/yawp/yawp-1.6.8/yawp-client/lib/web/yawp.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdn.jsdelivr.net/jquery.easing/1.3/jquery.easing.1.3.min.js"></script>
    <script src="/assets/js/classie.js"></script>
    <script src="/assets/js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="/assets/js/jqBootstrapValidation.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/assets/js/freelancer.js"></script>

    <!-- code formatter -->
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- Place this tag right after the last button or just before your close body tag. -->
    <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

    
    <script src="/assets/js/left-menu.js"></script>
    

    

    <script>
        yawp.config(function (c) {
            c.baseUrl('http://localhost:8080/api');
        });
        
        $('#yeti').addClass('animated swing');
//        $('#github').addClass('animated swing');
    </script>


</body>


</html>
